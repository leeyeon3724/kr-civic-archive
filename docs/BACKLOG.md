# 백로그

이 문서는 앞으로 진행할 작업만 관리합니다.

## 운영 원칙

- 완료 항목은 이 문서에 남기지 않습니다.
- 완료 이력은 기본적으로 `git log`로 관리합니다.
- 릴리스 노트가 필요한 변경은 `docs/CHANGELOG.md`에 기록합니다.
- 각 항목은 상태(`계획`, `진행 중`, `차단`)를 명시합니다.

## 현재 백로그

- 상태: `진행 중`
  - 항목: `app/observability.py` 예외 처리 시 메트릭/로그 경로 정합성 강화
  - 맥락: 예외 분기와 성공 분기가 중복되어 유지보수 지점이 분산되어 있고, 향후 예외 처리 정책 변경 시 누락 가능성 존재.
  - 대응: 예외/성공 모두에서 공통 메트릭·로그 페이로드 생성 경로를 단일 함수로 분리해 일관성을 확보.
  - 검증 기준: 400/500 예외 및 정상 경로에서 `civic_archive_http_requests_total` 라벨/카운트가 상태코드별로 기대대로 증가하는지 테스트.

- 상태: `계획`
  - 항목: `app/security_rate_limit.py` 메모리 기반 rate limiter 메모리 보호
  - 맥락: `_prune`이 키 개수 임계치 이상에서만 2개 윈도우 기준 정리되어 극단 트래픽 시 메모리 피크 증가 가능성.
  - 대응: 스로틀 동작 보장을 유지하면서 상한 기반 정리 정책 강화 및 테스트 보강.
  - 검증 기준: 한 윈도우 내 다량 신규 키 입력 시 내부 map 성장이 제한됨을 테스트로 검증.

- 상태: `계획`
  - 항목: `app/security_proxy.py` 클라이언트 IP 판별 보강
  - 맥락: `request.client` 미존재 시 `unknown` 키로 묶이면 rate limit이 비정상적으로 한 키로 집중될 수 있음.
  - 대응: untrusted/unresolved 환경에 대한 키 전략을 명시하고 장애/우회 시나리오 대비 정책 정의.
  - 검증 기준: `request.client` 미존재 및 프록시 헤더 조합별 키 산출 정책을 단위 테스트로 명세.

## 운영 메모

- 새 작업 추가 시 기존 항목과 중복 여부를 먼저 확인합니다.
- 작업 완료 시 본 문서에서 항목을 제거하고, 필요하면 `docs/CHANGELOG.md`에만 기록합니다.
