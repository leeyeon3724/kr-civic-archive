# 백로그

이 문서는 앞으로 진행할 작업만 관리합니다.

## 운영 원칙

- 완료 항목은 이 문서에 남기지 않습니다.
- 완료 이력은 기본적으로 `git log`로 관리합니다.
- 릴리스 노트가 필요한 변경은 `docs/CHANGELOG.md`에 기록합니다.
- 각 항목은 상태(`계획`, `진행 중`, `차단`)를 명시합니다.

## 현재 백로그

- 상태: `진행 중`
  - 항목: `app/bootstrap/middleware.py` 요청 크기 가드에서 `X-Request-Id` 상속 보장
  - 맥락: 현재 `/api` payload 413 경로에서 `request_size_guard`가 `error_response`를 직접 반환할 때, 이전에 관측성 미들웨어가 동작하지 않으면 응답 헤더에 `X-Request-Id`가 누락될 수 있음.
  - 대응: 요청 시작 시점에 `request.state.request_id`를 한 번 초기화하고, 기존 `observability` 경로와 공통 식별자 재사용.
  - 검증 기준: oversized 요청 413 응답에서 `response.headers["X-Request-Id"]`가 항상 존재/전파되는지 통합 테스트로 보장.

- 상태: `계획`
  - 항목: `app/observability.py` 예외 경로 가시성/메트릭/로그 처리 안정화
  - 맥락: 현재 예외 처리에서 상태코드 분기와 로그 분기가 뒤섞여 있고, 유지보수성/오탐 지표 가능성 있음.
  - 대응: 예외 분기/성공 분기 구조를 명시적으로 분리해 유지보수성 강화.
  - 검증 기준: 예외 처리 테스트(400/404/500) 시 메트릭 라벨/로그 경로가 정상 동작.

- 상태: `계획`
  - 항목: `app/security_rate_limit.py` 메모리 기반 rate limiter 메모리 보호
  - 맥락: `_prune`이 키 개수 임계치 이상에서만 2개 윈도우 기준 정리되어 극단 트래픽 시 메모리 피크 증가 가능성.
  - 대응: 스로틀 동작 보장을 유지하면서 상한 기반 정리 정책 강화 및 테스트 보강.
  - 검증 기준: 한 윈도우 내 다량 신규 키 입력 시 내부 map 성장이 제한됨을 테스트로 검증.

- 상태: `계획`
  - 항목: `app/security_proxy.py` 클라이언트 IP 판별 보강
  - 맥락: `request.client` 미존재 시 `unknown` 키로 묶이면 rate limit이 비정상적으로 한 키로 집중될 수 있음.
  - 대응: untrusted/unresolved 환경에 대한 키 전략을 명시하고 장애/우회 시나리오 대비 정책 정의.
  - 검증 기준: `request.client` 미존재 및 프록시 헤더 조합별 키 산출 정책을 단위 테스트로 명세.

## 운영 메모

- 새 작업 추가 시 기존 항목과 중복 여부를 먼저 확인합니다.
- 작업 완료 시 본 문서에서 항목을 제거하고, 필요하면 `docs/CHANGELOG.md`에만 기록합니다.
